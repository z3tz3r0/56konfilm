# ATDD Checklist - Epic 1, Story 1.2: Cinematic Layout & Global Transitions

**Date:** 2026-01-31
**Author:** Z3tz3r0
**Primary Test Level:** E2E

---

## Story Summary

Transition the user experience from a functional "Mode Switch" to a premium "Cinematic" emotional shift using a global "Curtain Wipe" animation.

**As a** User
**I want** smooth visual transitions when navigating or switching modes
**So that** the experience feels premium and continuous, not jarring

---

## Acceptance Criteria

1. **Curtain Wipe Animation**:
   - Given the user clicks the "Mode Switch" button (e.g., Commercial -> Wedding),
   - When the mode change triggers,
   - Then a full-screen "Curtain Wipe" animation (black for Commercial, white/cream for Wedding) MUST play.
   - And the content underneath MUST switch while the curtain is covering the screen.
   - And the animation duration MUST align with `--duration-slow` / `--duration-fast` variables.

2. **Dynamic Styling Updates**:
   - Given the mode changes,
   - When the transition completes (or during the curtain),
   - Then `background-color`, `font-family`, and `text-color` variables MUST update.
   - And there must be NO "flash of unstyled content" (FOUC) or "flash of wrong theme".

3. **Performance (CLS & FPS)**:
   - Given the transition is animating,
   - Then the browser Frame Rate MUST maintain 60fps.
   - And Cumulative Layout Shift (CLS) MUST be < 0.1.

---

## Failing Tests Created (RED Phase)

### E2E Tests (3 tests)

**File:** `tests/e2e/global-transition.spec.ts`

- ✅ **Test:** should trigger curtain wipe animation when switching modes
  - **Status:** RED - Element `[data-testid="curtain-wipe"]` not found.
  - **Verifies:** Curtain appears on click and disappears after animation.

- ✅ **Test:** should mask the theme change without FOUC
  - **Status:** RED - Element `[data-testid="curtain-wipe"]` not found.
  - **Verifies:** Curtain covers the screen during the critical theme swap moment.

- ✅ **Test:** should trigger curtain on mobile menu switch
  - **Status:** RED - Element `[data-testid="curtain-wipe"]` not found.
  - **Verifies:** Mobile users also get the premium transition experience.

---

## Data Factories Created

None required for this story (UI state only).

---

## Fixtures Created

### SiteMode Fixtures

**File:** `tests/support/fixtures/index.ts` (Existing)

**Fixtures:**

- `setMode` - Sets the site mode (commercial/wedding) via cookies.
- `siteMode` - Resolves the current visible mode from HTML class.

---

## Mock Requirements

None.

---

## Required data-testid Attributes

### Mode Switcher Component
- `mode-switcher` - Container (existing)

### Global Transition Component (New)
- `curtain-wipe` - The full-screen overlay element that animates in/out.

---

## Implementation Checklist

### Test: should trigger curtain wipe animation when switching modes

**File:** `tests/e2e/global-transition.spec.ts`

**Tasks to make this test pass:**

- [ ] Create `src/components/layout/GlobalTransition.tsx`
- [ ] Implement `CurtainWipe` logic using `motion/react`
- [ ] Add `data-testid="curtain-wipe"` to the curtain element
- [ ] Integrate component into `src/app/layout.tsx` (ensure it's initially hidden/present but invisible)
- [ ] Connect `useMode` store to trigger the animation (e.g. `isTransitioning` state or event)
- [ ] Run test: `npm run test:e2e -- global-transition.spec.ts`
- [ ] ✅ Test passes (green phase)

**Estimated Effort:** 2 hours

---

## Running Tests

```bash
# Run all failing tests for this story
npm run test:e2e -- global-transition.spec.ts

# Run tests in headed mode (see browser)
npm run test:e2e -- global-transition.spec.ts --headed

# Debug specific test
npm run test:e2e -- global-transition.spec.ts --debug
```

---

## Red-Green-Refactor Workflow

### RED Phase (Complete) ✅

**TEA Agent Responsibilities:**

- ✅ All tests written and failing
- ✅ data-testid requirements listed
- ✅ Implementation checklist created

### GREEN Phase (DEV Team - Next Steps)

**DEV Agent Responsibilities:**

1. **Pick one failing test** from implementation checklist
2. **Implement minimal code** to make that specific test pass
3. **Run the test** to verify it now passes (green)
4. **Move to next test** and repeat

---

**Generated by BMad TEA Agent** - 2026-01-31
