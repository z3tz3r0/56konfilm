# ATDD Checklist - Epic 2, Story 2.1: Enable Magazine Layouts for Projects

**Date:** 2026-01-29
**Author:** Z3tz3r0
**Primary Test Level:** E2E

---

## Story Summary

Enable the Modular Page Builder ("Magazine Layout") within Project documents to allow rich case studies beyond simple text. This requires schema updates, frontend rendering of dynamic blocks, and new metadata fields.

**As a** Content Admin
**I want** to use the Modular Page Builder inside "Project" documents
**So that** I can create magazine-style layouts for case studies.

---

## Acceptance Criteria

1. **Given** I am in Sanity Studio, **When** I edit a Project, **Then** I see `contentBlocks` array and can add Hero, MediaGallery, TwoColumn blocks.
2. **Given** I visit a Project Detail page, **Then** it renders the blocks correctly using existing Section Components.
3. **Given** the Project schema, **Then** it must include `Client`, `Services`, `Year` metadata.

---

## Failing Tests Created (RED Phase)

### E2E Tests (1 test)

**File:** `tests/e2e/project-magazine-layout.spec.ts`

- ✅ **Test:** `should render magazine blocks and new metadata`
  - **Status:** RED - Expected elements (test-ids and block classes) not found.
  - **Verifies:**
    - Metadata visibility (`client`, `year`, `services`)
    - Block rendering (`heroSection`, `twoColumnSection`, `mediaGallerySection`)

---

## Data Factories Created

### Project Factory

**File:** `tests/support/factories/project.factory.ts`

**Exports:**
- `createProject(overrides?)` - Create single project with magazine fields
- `createProjects(count)`

---

## Required data-testid Attributes

### Project Detail Page (`src/app/(site)/work/[slug]/page.tsx`)

- `project-client` - The element displaying the client name
- `project-year` - The element displaying the project year
- `project-services` - The element displaying the list of services

### Section Components (Wrapper)

- `section[data-sanity-type="heroSection"]` - Wrapper for Hero Section
- `section[data-sanity-type="twoColumnSection"]` - Wrapper for 2-Col Section
- `section[data-sanity-type="mediaGallerySection"]` - Wrapper for Media Gallery

---

## Implementation Checklist

### Test: should render magazine blocks and new metadata

**File:** `tests/e2e/project-magazine-layout.spec.ts`

**Tasks to make this test pass:**

- [ ] **Schema:** Modify `src/sanity/schemaTypes/projects.ts` to add `contentBlocks`, `client`, `services`, `year`.
- [ ] **Query:** Update `src/sanity/lib/queries.ts` to fetch these new fields for project pages.
- [ ] **Frontend:** Update `src/app/(site)/work/[slug]/page.tsx` to:
    - [ ] Render the Metadata (`client`, `year`, `services`) with `data-testid`.
    - [ ] Iterate over `contentBlocks` and render corresponding components.
    - [ ] Ensure `data-sanity-type` attribute is added to section wrappers for testing.
- [ ] **Seed Data:** Create a project with slug `atdd-magazine-test` in Sanity (or mock it) for the E2E test.
- [ ] Run test: `npm run test:e2e -- project-magazine-layout`
- [ ] ✅ Test passes (green phase)

**Estimated Effort:** 3 hours

---

## Running Tests

```bash
# Run failing test
npm run test:e2e -- project-magazine-layout.spec.ts
```

---

## Red-Green-Refactor Workflow

### RED Phase (Complete) ✅

**TEA Agent Responsibilities:**
- ✅ Failing E2E test created
- ✅ Project Factory created
- ✅ `src/types/sanity.ts` updated with new types
- ✅ Implementation checklist created

### GREEN Phase (DEV Team - Next Steps)

1. Pick the failing test.
2. Implement Schema & Query updates.
3. Implement Frontend rendering.
4. Verify Green.

---

**Generated by BMad TEA Agent**
