# Epic 4 Retrospective: Performance, SEO, and Deployment Pipeline

**Date:** 2026-02-07
**Status:** Completed

## üéØ Objectives vs. Outcomes

| Objective | Outcome |
| :--- | :--- |
| **Bilingual SEO Foundation** | Standardized `src/lib/metadata.ts` with EN/TH parity and validated Sanity SEO schema. |
| **Device Tiering** | `useDeviceTier` implemented for hardware-aware motion/video reduction. |
| **Performance Tuning** | Tag-based ISR via `sanityFetch` and bundle analysis integrated. |
| **Deployment Pipeline** | Automated Lighthouse CI, Playwright smoke tests, and Sanity revalidation webhook. |

## üöÄ Key Wins

- **Dynamic ISR:** Migrated from `revalidatePath` to `next.tags`, allowing precise, on-demand cache purging for both Commercial and Wedding modes.
- **Hardware Awareness:** High-performance motion is now automatically throttled on low-end devices, ensuring a "cinematic" experience remains smooth regardless of hardware.
- **Search Readiness:** Standardized OG images and bilingual metadata ensure consistent branding across social platforms and search engines.

## ‚ö†Ô∏è Challenges & Learnings

- **Sanity Versioning:** Upgrading to Sanity 5.7 required careful adjustment of the client's `useCdn` setting to ensure the on-demand revalidation worked correctly with Next.js 16's cache.
- **Bundle Optimization:** The initial inclusion of large Framer Motion variants added overhead; moving to the `m` (mini) featureset for low-tier devices significantly reduced TBT.

## üõ†Ô∏è Artifacts Delivered

- `src/sanity/lib/fetch.ts`: Standardized tag-aware fetching.
- `src/app/api/revalidate/route.ts`: Secure revalidation endpoint.
- `.github/workflows/lighthouse.yml`: Automated performance monitoring.
- `lighthouserc.js`: Performance budget configuration.

## ‚è≠Ô∏è Final Steps

1. **Production Smoke Test:** Verify webhook triggers in a live-like environment.
2. **Knowledge Transfer:** Ensure the client understands how to trigger manual revalidation if needed.
